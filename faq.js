// Data FAQ
const faqData = {
    "Jam Operasional": "Senin - Kamis: 07.30 - 16.00,\nJumat: 07.30 - 16.30",
    Lokasi: "Jl. Pemuda No.29 A, RT.01/RW.06, Tanah Sareal, Kec. Tanah Sereal, Kota Bogor, Jawa Barat 16161",
    Kontak: "Email: bpmsph@pertanian.go.id, \nTel/Fax: +62-251-8377111, +62-251-8353712",
    "Apakah aplikasi Sistem Manajemen Anti Penyuapan (SMAP) Balai Pengujian Mutu dan Sertifikasi Produk Hewan (BPMSPH) ini?":
        "Aplikasi Sistem Manajemen Anti Penyuapan (SMAP) Balai Pengujian Mutu dan Sertifikasi Produk Hewan (BPMSPH) adalah aplikasi pengelolaan dan tindak lanjut pengaduan serta pelaporan hasil pengelolaan pelaporan suap pungli dan gratifikasi yang disediakan oleh BPMSPH sebagai salah satu sarana bagi setiap pejabat/pegawai BPMSPH sebagai pihak internal maupun pengguna jasa dan penyedia jasa BPMSPH serta masyarakat luas pengguna layanan BPMSPH sebagai pihak eksternal untuk melaporkan dugaan adanya pelanggaran tindakan suap pungli dan gratifikasi dan/atau ketidakpuasan terhadap pelayanan yang dilakukan/diberikan oleh pejabat/pegawai BPMSPH.",
    "Penyuapan dan Gratifikasi": {
        "Saya ingin mengetahui apa yang dimaksud dengan penyuapan dan gratifikasi?":
            "Penyuapan adalah tindakan menawarkan,  menjanjikan,  memberikan, menerima atau meminta keuntungan  yang  tidak  semestinya dari  nilai  apapun (berupa keuangan atau non keuangan),  langsung  atau  tidak  langsung, terlepas dari lokasi, merupakan pelanggaran peraturan perundang-undangan, sebagai bujukan atau hadiah untuk orang yang bertindak atau menahan diri dari bertindak terkait kinerja dari tugas orang tersebut. \n\nGratifikasi  adalah  pemberian  dalam  arti  luas  yakni  meliputi  pemberian  uang, barang, rabat (discount), komisi,  pinjaman  tanpa  bunga,  tiket perjalanan, fasilitas penginapan, perjalanan wisata, pengobatan cuma-cuma, dan fasilitas lainnya yang diterima di dalam negeri maupun di luar negeri dan yang menggunakan sarana elektronik atau tanpa sarana elektronik.",
        "Saya ingin mengetahui apa perbedaan pengaturannya antara penyuapan dengan gratifikasi?":
            "Penyuapan: \n1. Kitab Undang-Undang Hukum Pidana (Wetboek van Strafrecht, Staatsblad 1915 No 73), \n2. UU No. 11 Tahun 1980 tentang Tindak Pidana Suap (“UU 11/1980”) \n3.  UU No. 20 Tahun 2001 tentang Perubahan UU No. 31 Tahun 1999 tentang Pemberantasan Tindak Pidana Korupsi serta diatur pula dalam UU No. 30 Tahun 2002 tentang Komisi Pemberantasan Korupsi (“UU Pemberantasan Tipikor”)  \n\nGratifikasi: \n1.  UU No. 20 Tahun 2001 tentang Perubahan UU No. 31 Tahun 1999 tentang Pemberantasan Tindak Pidana Korupsi serta diatur pula dalam UU No. 30 Tahun 2002 tentang Komisi Pemberantasan Korupsi (“UU Pemberantasan Tipikor”), \n2. Peraturan Menteri Keuangan Nomor 03/PMK.06/2011 tentang Pengelolaan Barang Milik Negara yang Berasal Dari Barang Rampasan Negara dan Barang Gratifikasi.",
        "Saya ingin mengetahui apa perbedaan definisinya antara penyuapan dengan gratifikasi?":
            "Penyuapan: \nBarangsiapa menerima sesuatu atau janji, sedangkan ia mengetahui atau patut dapat menduga bahwa pemberian sesuatu atau janji itu dimaksudkan supaya ia berbuat sesuatu atau tidak berbuat sesuatu dalam tugasnya, yang berlawanan dengan kewenangan atau kewajibannya yang menyangkut kepentingan umum, dipidana karena menerima suap dengan pidana penjara selama-lamanya 3 (tiga) tahun atau denda sebanyak-banyaknya Rp.15.000.000.- (lima belas juta rupiah) (Pasal 3 UU 3/1980). \n\nGratifikasi: \nPemberian dalam arti luas, yakni meliputi pemberian uang, barang, rabat (discount), komisi, pinjaman tanpa bunga, tiket perjalanan, fasilitas penginapan, perjalanan wisata, pengobatan cuma-cuma, dan fasilitas lainnya. Gratifikasi tersebut baik yang diterima di dalam negeri maupun di luar negeri dan yang dilakukan dengan menggunakan sarana elektronik atau tanpa sarana elektronik (Penjelasan Pasal 12B UU Pemberantasan Tipikor)",
        "Saya ingin mengetahui apa perbedaan sanksinya antara penyuapan dengan gratifikasi?":
            "Penyuapan: \n1. UU 11/1980: Pidana penjara selama-lamanya 3 (tiga) tahun atau denda sebanyak-banyaknya Rp.15.000.000.- (lima belas juta rupiah) (Pasal 3 UU 3/1980). \n2. KUHP: pidana penjara paling lama sembilan bulan atau pidana denda paling banyak empat ribu lima ratus rupiah (Pasal 149) \n3. UU Pemberantasan Tipikor: Dipidana dengan pidana penjara paling singkat 1 (satu) tahun dan paling lama 5 (lima) tahun dan atau pidana denda paling sedikit Rp 50.000.000,00 (lima puluh juta rupiah) dan paling banyak Rp 250.000.000,00 (dua ratus lima puluh juta rupiah) pegawai negeri atau penyelenggara negara yang menerima hadiah atau janji padahal diketahui atau patut diduga, bahwa hadiah atau janji tersebut diberikan karena kekuasaan atau kewenangan yang berhubungan dengan jabatannya, atau yang menurut pikiran orang yang memberikan hadiah atau janji tersebut ada hubungan dengan jabatannya (Pasal 11 UU Pemberantasan Tipikor). \n\nGratifikasi: \nPidana penjara seumur hidup atau pidana penjara paling singkat 4 (empat) tahun dan paling lama 20 (dua puluh) tahun, dan pidana denda paling sedikit Rp 200.000.000,00 (dua ratus juta rupiah) dan paling banyak Rp 1.000.000.000,00 (satu miliar rupiah) (Pasal 12B ayat [2] UU Pemberantasan Tipikor).",
    },
    Pelaporan: {
        "Apakah bentuk respon yang diberikan kepada pelapor atas pelaporan yang disampaikan?":
            "Respon yang diberikan kepada pelapor berupa status/tindak lanjut pelaporan paling akhir sesuai dengan respon yang telah diberikan oleh pihak penerima laporan. Respon terkait dengan status/tindak lanjut pelaporan dapat dilihat dalam history laporan aplikasi SMAP BPMSPH.",
        "Berapa lama respon atas pelaporan yang disampaikan diberikan kepada pelapor?":
            "Sesuai dengan KMK 149 tahun 2011 jawaban/respon atas pengaduan yang disampaikan wajib diberikan dalam kurun waktu paling lambat 30 (tiga puluh) hari terhitung sejak pelaporan diterima. Untuk respon yang disampaikan tertulis melalui surat dapat diberikan apabila pelapor mencantumkan identitas secara jelas (nama dan alamat koresponden). Untuk respon dari media pelaporan lainnya akan disampaikan dan diberikan sesuai identitas pelapor yang dicantumkan dalam media pelaporan tersebut.",
        "Apakah pelaporan yang saya berikan akan selalu mendapatkan respon?":
            "Pelaporan Suap Pungli dan Gratifikasi yang anda berikan akan direspon dan tercantum dalam aplikasi SMAP BPMSPH ini dan akan terupdate secara otomatis sesuai dengan respon yang telah diberikan oleh pihak penerima pelaporan. Untuk dapat melihat respon yang diberikan, anda harus login terlebih dahulu dengan username yang telah anda registrasikan di aplikasi ini dan anda dapat melihat status pelaporan dalam history pelaporan sesuai dengan nomor register pelaporan yang didapatkan. Sebagai catatan, pelaporan anda akan lebih mudah ditindaklanjuti apabila memenuhi unsur pelaporan. Hal Lebih lanjut/lengkap terkait dengan unsur pelaporan dapat dilihat disini.",
        "Apakah kerahasiaan identitas saya sebagai pelapor terjaga?":
            "Kerahasiaan identitas anda sebagai pelapor akan terjaga seperti yang telah disebutkan dalam KMK 149 tahun 2011. Namun agar kerahasiaan identitas anda dapat lebih terjaga sebaiknya anda memperhatikan hal-hal sebagaimana disebutkan dalam KMK 149 tahun 2011.",
        "Apakah setiap melakukan pelaporan harus membuat dan register username?":
            "Hal tersebut tidak perlu dilakukan. Satu username dapat melakukan pelaporan lebih dari satu. Ketika setelah selesai membuat satu pelaporan, anda dapat membuat pelaporan terkait dengan dugaan pelanggaran dan/atau ketidakpuasan terhadap pelayanan yang diberikan lainnya dengan memilih tambah pelaporan. Masing-masing pelaporan akan mendapatkan balasan email yang berbeda.",
        "Saya sudah mengirimkan pelaporan namun di kemudian hari saya ingin merubah atau menambahkan data terkait pelaporan yang saya lakukan, apa yang harus saya lakukan?":
            "Data yang sudah dilaporkan sebelumnya tidak dapat dilakukan perubahan namun anda bisa menambahkan data lain terkait pelaporan dengan mengunggah data dalam bentuk seperti dokumen, foto, video, dan lain sebagainya masing-masing dengan ukuran maksimum 10 MB. Untuk melakukan hal tersebut diatas tidak perlu membuat pelaporan baru. Mengunggah data tambahan baru dapat dilakukan dengan login username yang telah diregistrasikan sebelumnya di aplikasi ini lalu masuk ke halaman pelaporan. Dalam halaman pelaporan, anda memilih pelaporan yang ingin ditambahkan data tambahan kemudian memilih (klik kotak kecil tambah lampiran pelaporan) di bagian bawah rincian pelaporan.",
    },
    Layanan: {
        "Pengujian Laboratorium": {
            "Uji Fisika-Kimia":
                "Uji Fisik: \nUji Fisik bau, warna, rasa (Daging, Telur, Susu segar, Susu Bubuk), \nKonsistensi (Daging), \npH (Daging), \nAwal Pembusukan (Daging), \nKesempurnaan pengeluaran darah (Daging), \npH (Susu Segar), \nUji didih (Susu Segar), \nAlkohol (Susu Segar), \nCandling (Telur), \nTinggi kantung hawa (Telur), \nIndeks Kuning (Telur), \nIndeks Albumin (Telur). \n\nResidu Hormon dan Growth Promotor: \nHormon Diethylstilbestrol (DES) HPLC, \nHormon Trenbolon Acetat (TBA) HPLC, \nHormon Trenbolon Acetat (TBA) ELISA, \nHormon Malengesterol Acetat (MGA) HPLC, \nHormon Zeranol HPLC, \nRactopamin ELISA, \nBeta Agonis (Clenbuterol/Salbutamol) ELISA. \n\nKonfirmasi Residu Antibiotika: \nKonfirmasi antibiotik gol. Penicillin, \nKonfirmasi antibiotik gol. Tetracyclin, \nKonfirmasi antibiotik gol. Makrolida, \nKonfirmasi antibiotik gol. Aminoglikosida, \nKonfirmasi antibiotik gol. Chloramphenicol. \n\nResidu Pestisida: \nOrganoklorin \nOrganofosfat. \n\nProksimat: \nKadar Laktosa Susu Bubuk, \nKadar Air (Moisture Content), \nKadar Abu (Ash Content), \nKadar Lemak, \nKadar Protein. \n\nKeasaman (Acidity) Susu bubuk \n\nInsolubility Index Susu bubuk \n\nKolesterol \n\nProksimat susu segar dengan Lactoscan: Protein, Karbohidrat, Lemak, BJ, PH, Kadar Air, Kadar Abu (Proksimat / Lacto Scan). \n\nResidu Logam Berat (Per jenis logam) \n\nPengawet / additive: \nUji Borax, \nNitrit, \nUji Formalin, \nClorin, \nH2O2 (Peroksida), \nSudan Red I, II, III, IV, G, 7b, \nPewarna Sintetik Kualitatif \n\nIdentifikasi Spesies 4 jenis dengan ELISA: (Sapi, Unggas, Babi, Kambing) \n\nIdentifikasi Spesies 6 jenis dengan PCR: (Unggas, Sapi, Kambing, Domba, Tikus, Babi) \n\nAflatoksin M",
            "Uji Residu Obat":
                "Residu Antibiotika-Antimikroba: Uji Tapis Screening Gol.Penicillin (PC’s), Tetrasiklin (TC’s), Makrolida (ML’s), Aminoglikosida (AG’s) \nPengujian Residu Sulfa (Uji Tapis Screening) \nPengujian Enrofloxacin (ELISA) \nNitrofuran (AMOZ, Menggunakan ELISA) \nAnthelmintics (Multi Analysis Drug Residue) \nUji Senstifitas Antimikrobial / Antimikrobial Resistance (AMR)",
            "Uji Cemaran Mikroba":
                "TPC, \nEscherichia coli CFU, \nEscherichia coli MPN, \nFecal coliform CFU, \nFecal coliform MPN, \nSalmonella spp, \nSalmonella enteridis, \nStaphylococcus aureus, \nKapang, \nKhamir, \nListeria monocytogenes, \nClostridium perfrigens, \nBacillus cereus, \nCampylobacter jejuni, \nCampylobacter jejuni (Real Time PCR)",
        },
        "Uji Profisiensi":
            "<img src='/assets/Uji-Profisiensis.jpeg' alt='uji profisiensi' style='max-width: 100%; height: auto;'/>",
        "Tata Cara Pengiriman Sample": {
            Deskripsi: "Berikut adalah tata cara pengiriman sample:",
            Gambar: [
                "<img src='/assets/Tata-Cara-Pengiriman-Sampel.jpg' alt='Tata Cara Pengiriman Sample' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/persyaratan-pengujian.jpeg' alt='Persyaratan Pengujian' style='max-width: 100%; height: auto;'/>",
            ],
        },
        "Tarif Uji": {
            Deskripsi:
                "Tarif Uji (berdasarkan Peraturan Menteri Keuangan No.85 Tahun 2023)",
            Gambar: [
                "<img src='/assets/Tarif-uji1.jpg' alt='Tarif Uji' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/Tarif-uji2.jpg' alt='Tarif Uji' style='max-width: 100%; height: auto;'/>",
            ],
        },
        "Tarif dan Fasilitas Sewa Ruang Rapat dan Kamar Tamu Gedung BIMTEK": {
            Deskripsi:
                "Tarif dan Fasilitas Sewa Ruang Rapat dan Kamar Tamu Gedung BIMTEK. \nAnda dapat membooking atau melihat lebih detail pada aplikasi https://spill-b.bpmsph.org/",
            Gambar: [
                "<img src='/assets/tarif-sewa1.jpeg' alt='Tarif Sewa Bimtek' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/tarif-sewa2.jpeg' alt='Tarif Sewa Bimtek' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/alur-permohonan-sewa.jpg' alt='Alur Permohonan Sewa Bimtek' style='max-width: 100%; height: auto;'/>",
            ],
        },
        "Tarif Layanan Magang, PKL dan Bimbingan Teknis": {
            Deskripsi:
                "Apabila tertarik untuk mengajukan Magang / PKL / Bimbingan Teknis di tempat kami, maka anda bisa menghubungi kami mengajukan permohonan lewat https://spill-b.bpmsph.org/ dengan persyaratan dan alur sebgagai berikut: \n\nPersyaratan Pelayanan, Prosedur Pelayanan, dan Tarifnya (Berdasarkan PMK No.85 Tahun 2023). ",
            Gambar: [
                "<img src='/assets/persyaratan-pelayanan.jpeg' alt='Persyaratan Pelayanan' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/prosedur-pelayanan.jpeg' alt='Prosedur Pelayanan' style='max-width: 100%; height: auto;'/>",
                "<img src='/assets/tarif-magang.jpg' alt='Tarif Magang' style='max-width: 100%; height: auto;'/>",
            ],
        },
    },
};

// Fungsi untuk memulai chat
function handleChat() {
    createChatMessage(
        "Halo, selamat datang di Frequently Asked Question (FAQ) SMI BPMSPH. Silahkan tekan mulai untuk melihat pertanyaan yang sering ditanyakan.",
        "incoming"
    );
    document.getElementById("startBtn").style.display = "block";
}

// Fungsi pembantu untuk mengambil data berdasarkan path
function getDataByPath(data, pathArray) {
    return pathArray.reduce(
        (acc, key) => (acc && acc[key] ? acc[key] : null),
        data
    );
}

// Fungsi untuk membuat pesan di chat
function createChatMessage(message, className) {
    const chatMessage = document.createElement("div");
    chatMessage.className = `chat ${className}`;

    // Cek jika ada tag <img> di dalam pesan
    const isImage = message.includes("<img");

    if (isImage) {
        chatMessage.innerHTML = message;
        const img = chatMessage.querySelector("img");
        if (img) {
            img.style.cursor = "pointer";
            img.onclick = function () {
                openImageModal(img.src, img.alt);
            };
        }
    } else {
        chatMessage.innerHTML = message.replace(/\n/g, "<br>");
    }
    appendMessage(chatMessage);
}

// Fungsi untuk menambah pesan dan scroll otomatis
function appendMessage(message) {
    const chatBox = document.querySelector("#chatBox");
    chatBox.appendChild(message);
    chatBox.scrollTo(0, chatBox.scrollHeight); // Scroll otomatis ke bawah
}

// Fungsi untuk menampilkan opsi pilihan di dalam chat dengan path
function createChatOptions(options, currentPath = "") {
    const chatMessage = document.createElement("div");
    chatMessage.className = "chat incoming";

    let optionButtons = '<div class="chat-options">';
    for (const option in options) {
        if (option !== "Deskripsi" && option !== "Gambar") {
            const newPath = currentPath ? `${currentPath}/${option}` : option;
            optionButtons += `<button onclick="handleOption('${newPath}')">${option}</button>`;
        }
    }
    optionButtons += "</div>";

    chatMessage.innerHTML = optionButtons;
    appendMessage(chatMessage);
}

// Fungsi untuk menangani pilihan opsi dengan path
function handleOption(fullPath) {
    document.getElementById("startBtn").style.display = "none";
    const optionName = fullPath.split("/").pop();
    createChatMessage(`Anda memilih: ${optionName}`, "outgoing");

    setTimeout(() => {
        const pathArray = fullPath.split("/");
        const selectedData = getDataByPath(faqData, pathArray);

        if (selectedData) {
            if (typeof selectedData === "object") {
                if (selectedData.Deskripsi) {
                    createChatMessage(selectedData.Deskripsi, "incoming");
                }
                if (selectedData.Gambar && Array.isArray(selectedData.Gambar)) {
                    selectedData.Gambar.forEach((imgHtml) => {
                        createChatMessage(imgHtml, "incoming");
                    });
                }
                if (
                    Object.keys(selectedData).filter(
                        (key) => key !== "Deskripsi" && key !== "Gambar"
                    ).length > 0
                ) {
                    createChatOptions(selectedData, fullPath);
                }
            } else if (typeof selectedData === "string") {
                createChatMessage(
                    selectedData.replace(/\n/g, "<br>"),
                    "incoming"
                );
            } else {
                createChatMessage(
                    "Maaf, tidak ada jawaban yang sesuai.",
                    "incoming"
                );
            }
            document.getElementById("startBtn").style.display = "block";
        } else {
            createChatMessage(
                "Maaf, tidak ada jawaban yang sesuai.",
                "incoming"
            );
            document.getElementById("startBtn").style.display = "block";
        }
    }, 1000);
}

// Fungsi untuk menampilkan opsi awal
function showOptions() {
    createChatMessage(
        "Berikut adalah pertanyaan yang sering ditanyakan, silahkan pilih pertanyaannya:",
        "incoming"
    );
    createChatOptions(faqData);
    document.getElementById("startBtn").style.display = "none";
}

// Fungsi untuk menampilkan modal gambar
function openImageModal(imageUrl, altText) {
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("modalImage");
    const captionText = document.getElementById("caption");

    modal.style.display = "block";
    modalImg.src = imageUrl;
    captionText.innerHTML = altText;

    const closeModal = document.getElementsByClassName("close")[0];
    closeModal.onclick = function () {
        modal.style.display = "none";
    };
}

window.onload = function () {
    handleChat();
};
