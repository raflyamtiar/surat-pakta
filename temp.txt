membuat sebuah website surat pakta integritas dimana user bisa membuat surat seusai role yg dia pilih ada pegawai,penyedia jasa,pengguna jasa, dan auditor. tiap role memiliki perjanjian yg berbeda, user hanya bisa melakukan isi form, download surat dan edit surat, user pun tidak perlu login untuk membuat surat. lalu ada admin dimana ini berfungsi untuk mengelola surat surat yg di buat user berarti admin dan user satu table , dimana admin bisa membuat surat, mengedit, mendownload, menghapus, search dan export excel dan hanya admin yg bisa login untuk keamanan.

PaktaIntegritasController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\PaktaIntegritas;
use App\Exports\PaktaIntegritasExport;
use Maatwebsite\Excel\Facades\Excel;
use Barryvdh\DomPDF\Facade\Pdf;
use SimpleSoftwareIO\QrCode\Facades\QrCode;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\URL;
use Illuminate\Support\Str;

class PaktaIntegritasController extends Controller
{

    public function index(Request $request, $role)
    {
        // Memulai query untuk mendapatkan data berdasarkan role
        $query = PaktaIntegritas::where('role', $role)->orderBy('created_at', 'desc');

        // Jika ada parameter pencarian, tambahkan ke query
        if ($request->has('search')) {
            $search = $request->input('search');
            $query->where(function($q) use ($search) {
                $q->where('nama', 'like', '%' . $search . '%')
                ->orWhere('jabatan', 'like', '%' . $search . '%')
                ->orWhere('instansi', 'like', '%' . $search . '%')
                ->orWhere('email', 'like', '%' . $search . '%')
                ->orWhere('no_whatsapp', 'like', '%' . $search . '%');
            });
        }

        // Melakukan paginasi pada hasil query
        $data = $query->paginate(10);

        // Hitung jumlah data untuk setiap role
        $roleCounts = PaktaIntegritas::select('role', DB::raw('count(*) as total'))
                                    ->groupBy('role')
                                    ->pluck('total', 'role');

        $countPegawai = $roleCounts['pegawai'] ?? 0;
        $countPenyediaJasa = $roleCounts['penyedia-jasa'] ?? 0;
        $countPenggunaJasa = $roleCounts['pengguna-jasa'] ?? 0;
        $countAuditor = $roleCounts['auditor'] ?? 0;

        // Kirimkan data ke view
        return view('admin.admin_' . strtolower($role), compact('data', 'role', 'countPegawai', 'countPenyediaJasa', 'countPenggunaJasa', 'countAuditor'));
    }

    public function store(Request $request)
    {
        // Validasi data form
        $request->validate([
            'nama' => 'required|string|max:100',
            'jabatan' => 'required|string|max:70',
            'instansi' => 'required|string|max:70',
            'alamat' => 'required|string|max:200',
            'email' => 'required|email',
            'kota' => 'required|string|max:35',
            'tanggal' => 'required|date',
            'no_whatsapp' => 'required|string',
            'role' => 'required|string',
        ]);

        // Pastikan nomor WhatsApp diawali dengan '62'
        $noWhatsapp = $request->input('no_whatsapp');
        if (!str_starts_with($noWhatsapp, '62')) {
            $noWhatsapp = '62' . ltrim($noWhatsapp, '0'); // Menghilangkan '0' di awal jika ada
        }

        // Menyimpan data ke database
        $paktaIntegritas = PaktaIntegritas::create(array_merge($request->all(), ['no_whatsapp' => $noWhatsapp]));

        // Cek referer URL untuk menentukan redirect
        if (strpos(URL::previous(), 'admin') !== false) {
            // Jika request berasal dari halaman admin, redirect ke halaman admin sesuai role
            return redirect()->route('admin.role', strtolower(str_replace(' ', '-', $request->role)))->with('success', 'Data Berhasil Disimpan');
        } else {
            // Jika request berasal dari halaman index atau lainnya, redirect ke down_surat
            return redirect()->route('user.down-surat')->with('success', 'Data Berhasil Disimpan');
        }
    }

    public function userSurat()
    {
        $paktaIntegritas = PaktaIntegritas::latest()->take(1)->get();
        return view('down_surat', compact('paktaIntegritas'));
    }

    public function showForm($role)
    {
        return view('admin.admin_add', ['role' => $role]);
    }

    public function destroy($role, $id)
    {
        // Mencari data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Menghapus data
        $data->delete();

        // Redirect kembali ke halaman yang sesuai dengan pesan sukses
        return redirect()->route('admin.role', $role)->with('success', 'Data Berhasil Dihapus');
    }

    public function update(Request $request, $role, $id)
    {
        // Validasi data form
        $request->validate([
            'nama' => 'required|string|max:100',
            'jabatan' => 'required|string|max:50',
            'instansi' => 'required|string|max:70',
            'alamat' => 'required|string',
            'email' => 'required|email',
            'kota' => 'required|string|max:35',
            'tanggal' => 'required|date',
            'no_whatsapp' => 'required|string',
        ]);

       // Pastikan nomor WhatsApp diawali dengan '62'
        $noWhatsapp = $request->input('no_whatsapp');
        if (!str_starts_with($noWhatsapp, '62')) {
            $noWhatsapp = '62' . ltrim($noWhatsapp, '0'); // Menghilangkan '0' di awal jika ada
        }

        // Mencari data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Mengupdate data
        $data->update(array_merge($request->all(), ['no_whatsapp' => $noWhatsapp]));

        // Redirect kembali ke halaman tabel sesuai role
        return redirect()->route('admin.role', strtolower(str_replace(' ', '-', $role)))->with('success', 'Data berhasil diupdate');
    }


    public function edit($role, $id)
    {
        // Mencari data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Mengirimkan data ke view yang sesuai
        return view('admin.admin_edit', compact('data', 'role'));
    }

    public function editUserSurat($id)
    {
        // Temukan data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Kirimkan data ke view
        return view('edit_surat', compact('data'));
    }

    public function updateUserSurat(Request $request, $id)
    {
        // Validasi data form
        $request->validate([
            'nama' => 'required|string|max:100',
            'jabatan' => 'required|string|max:70',
            'instansi' => 'required|string|max:70',
            'alamat' => 'required|string|max:200',
            'email' => 'required|email',
            'kota' => 'required|string|max:35',
            'tanggal' => 'required|date',
            'no_whatsapp' => 'required|string',
        ]);

        // Pastikan nomor WhatsApp diawali dengan '62'
        $noWhatsapp = $request->input('no_whatsapp');
        if (!str_starts_with($noWhatsapp, '62')) {
            $noWhatsapp = '62' . ltrim($noWhatsapp, '0'); // Menghilangkan '0' di awal jika ada
        }

        // Temukan data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Update data
        $data->update(array_merge($request->all(), ['no_whatsapp' => $noWhatsapp]));

        // Redirect ke halaman down_surat dengan pesan sukses
        return redirect()->route('user.down-surat')->with('success', 'Data berhasil diupdate');
    }


    // export excel
    public function export($role)
    {
        return Excel::download(new PaktaIntegritasExport($role), 'data-' . $role . '.xlsx');
    }

    // download pdf dan template
    public function downloadPdf($role, $id)
    {
        try {
            $data = PaktaIntegritas::findOrFail($id);
        } catch (ModelNotFoundException $e) {
            return redirect()->route('admin.role', $role)->withErrors(['message' => 'Data tidak ditemukan']);
        }

        // Temukan data Pakta Integritas berdasarkan ID yang diberikan
        $data = PaktaIntegritas::findOrFail($id);

        // Dapatkan pernyataan, perjanjian, dan judul berdasarkan role
        $result = $this->getPerjanjianByRole($role);
        $pernyataan = $result['pernyataan'];
        $perjanjian = $result['perjanjian'];
        $judul = $result['judul'];

        // Path ke gambar kop surat yang akan digunakan dalam surat
        $path = public_path('assets/kop-surat.jpg');
        $type = pathinfo($path, PATHINFO_EXTENSION);
        $dataGambar = file_get_contents($path);
        $base64 = 'data:image/' . $type . ';base64,' . base64_encode($dataGambar);

        // Generate QR Code untuk WhatsApp
        $phone = '62' . ltrim($data->no_whatsapp, '0'); // Menghapus '0' di awal dan menambahkan '62'
        $waLink = 'https://wa.me/' . $phone;
        $qrcodeSvg = QrCode::format('svg')->size(80)->generate($waLink);
        $qrcodeSvgClean = str_replace('<?xml version="1.0" encoding="UTF-8"?>', '', $qrcodeSvg);
        $qrcodeBase64 = base64_encode($qrcodeSvgClean);


        // Render view template_surat dengan data yang sudah disiapkan
        $html = view('template.template_surat', compact('data', 'pernyataan', 'perjanjian', 'base64', 'judul', 'qrcodeBase64'))->render();

        // Load HTML ke dalam DOMPDF
        $pdf = Pdf::loadHTML($html);

        // Bersihkan nama file dari karakter yang tidak valid
        $invalidCharacters = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];
        $sanitizedFileName = str_replace($invalidCharacters, '-', $data->nama);

        // Unduh file PDF dengan nama yang sesuai
        switch (strtolower($role)) {
            case 'pegawai':
                $fileName = 'PaktaIntegritas-Pegawai-' . $sanitizedFileName . '.pdf';
                break;
            case 'penyedia-jasa':
                $fileName = 'PaktaIntegritas-PenyediaJasa-' . $sanitizedFileName . '.pdf';
                break;
            case 'pengguna-jasa':
                $fileName = 'PaktaIntegritas-PenggunaJasa-' . $sanitizedFileName . '.pdf';
                break;
            case 'auditor':
                $fileName = 'PaktaIntegritas-Auditor-' . $sanitizedFileName . '.pdf';
                break;
            default:
                $fileName = 'PaktaIntegritas-' . $sanitizedFileName . '.pdf';
                break;
        }

        return $pdf->download($fileName);
    }

    // Fungsi untuk mendapatkan perjanjian berdasarkan role
    private function getPerjanjianByRole($role)
    {
        $judul = '';
        $perjanjian = [];
        $pernyataan = '';

        switch (strtolower($role)) {
            case 'pegawai':
                $judul = "ANTI SUAP PUNGLI GRATIFIKASI, KETIDAKBERPIHAKAN DAN KERAHASIAAN";
                $pernyataan = "Menyatakan bahwa saya dengan sungguh-sungguh dalam rangka pelaksanaan pemeriksaan dan pengujian di BPMSPH bersedia menjalankan dan mentaati hal-hal seperti yang tertulis dibawah ini :";
                $perjanjian = [
                    "Berperan secara pro aktif dalam upaya pencegahan dan pemberantasan Korupsi, Kolusi dan Nepotisme (KKN) serta tidak melibatkan diri dalam perbuatan tercela;",
                    "Berkomitmen tidak meminta pemberian secara langsung dan/atau tidak langsung berupa suap, hadiah, bantuan, atau bentuk lainnya yang tidak sesuai dengan ketentuan yang berlaku serta melaporkan pemberian tersebut apabila menerimanya;",
                    "Berkomitmen bersikap transparan, jujur, objektif dan akuntabel untuk tidak terlibat atau terpengaruh terhadap tekanan komersial, keuangan yang dapat mempengaruhi hasil pengujian untuk menghindari benturan kepentingan (conflict of interest) dalam pelaksanaan tugas;",
                    "Berkomitmen untuk bebas dari kegiatan lain, internal dan eksternal yang dapat mengurangi kepercayaan dalam kemandirian pertimbangan dan integritas dalam kegiatan pengujian, dan berpengaruh buruk terhadap mutu kerja;",
                    "Berkomitmen untuk bekerja secara profesional, menjunjung tinggi aturan yang berlaku baik di lingkungan laboratorium pengujian;",
                    "Berkomitmen untuk menjaga kerahasiaan informasi dan hak kepemilikan dari pelanggan Laboratorium sesuai dengan persyaratan dan ketentuan yang berlaku, termasuk informasi dalam bentuk elektronik;",
                    "Berkomitmen memberi contoh dalam kepatuhan terhadap peraturan perundang-undangan dalam melaksanaan tugas terutama kepada pegawai yang berada di bawah pengawasan saya dan sesama pegawai di lingkungan kerja saya secara konsisten;",
                    "Berkomitmen menyampaikan informasi penyimpangan integritas serta turut menjaga kerahasiaan atas pelanggaran peraturan yang dilaporkannya;",
                    "Bila saya melanggar hal-hal tersebut di atas, saya siap menghadapi konsekuensi berdasarkan ketentuan dan perundang-undangan yang berlaku."
                ];
                break;
            case 'penyedia-jasa':
                $judul = "PENYEDIA JASA";
                $pernyataan = "Menyatakan bahwa saya dengan sungguh-sungguh dalam rangka pelaksanaan pemeriksaan dan pengujian di BPMSPH bersedia menjalankan dan mentaati hal-hal seperti yang tertulis dibawah ini:";
                $perjanjian = [
                    "Berperan secara pro aktif dalam upaya pencegahan dan pemberantasan Korupsi, Kolusi dan Nepotisme (KKN) serta tidak melibatkan diri dalam perbuatan tercela;",
                    "Tidak melakukan pemberian secara langsung dan/atau tidak langsung berupa suap, hadiah, bantuan, atau bentuk lainnya yang tidak sesuai dengan ketentuan yang berlaku serta melaporkan pemberian permintaan tersebut apabila ada yang menerimanya;",
                    "Bersikap transparan, jujur, objektif dan akuntabel dalam melaksanakan kegiatan sebagai penyedia jasa;",
                    "Menghindari benturan kepentingan (conict of interest) dalam pelaksanaan kegiatan sebagai penyedia jasa;",
                    "Memberi contoh dalam kepatuhan terhadap peraturan perundang-undangan dalam melaksanakan kegiatan sebagai penyedia jasa;",
                    "Akan menyampaikan informasi penyimpangan integritas serta turut menjaga kerahasiaan atas pelanggaran peraturan yang dilaporkannya;",
                    "Bila saya melanggar hal-hal tersebut di atas, saya siap menghadapi konsekuensi berdasarkan ketentuan dan perundang-undangan yang berlaku."
                ];
                break;
            case 'pengguna-jasa':
                $judul = "PENGGUNA JASA";
                $pernyataan = "Menyatakan bahwa saya dengan sungguh-sungguh akan menjalankan dan mentaati hal-hal seperti yang tertulis dibawah ini:";
                $perjanjian = [
                    "Berperan secara pro aktif dalam upaya pencegahan dan pemberantasan Korupsi, Kolusi dan Nepotisme (KKN) serta tidak melibatkan diri dalam perbuatan tercela;",
                    "Bersikap transparan, jujur, objektif dan akuntabel dalam melaksanakan kegiatan sebagai pengguna jasa;",
                    "Menghindari benturan kepentingan (conict of interest) dalam pelaksanaan kegiatan sebagai pengguna jasa;",
                    "Memberi contoh dalam kepatuhan terhadap peraturan perundang-undangan dalam melaksanakan kegiatan sebagai pengguna jasa;",
                    "Akan menyampaikan informasi penyimpangan integritas serta turut menjaga kerahasiaan atas pelanggaran peraturan yang dilaporkannya;",
                    "Bila saya melanggar hal-hal tersebut di atas, saya siap menghadapi konsekuensi berdasarkan ketentuan dan perundang-undangan yang berlaku."
                ];
                break;
            case 'auditor':
                $judul = "KETIDAKBERPIHAKAN AUDITOR INTERNAL";
                $pernyataan = "Menyatakan bahwa Saya sebagai Auditor Internal menandatangani & menjalankan “Pakta Integritas Ketidakberpihakan Auditor Internal” dengan ketentuan sebagai berikut:";
                $perjanjian = [
                    "Auditor Internal tidak akan berpihak kepada pihak tertentu dalam menjalankan fungsinya saat melaksanakan audit;",
                    "Auditor Internal tidak diperkenankan melakukan kerjasama dalam ketidakbenaran terkait temuan saat melaksanakan audit dengan auditee;",
                    "Auditor Internal menyadari dengan sepenuh hati terhadap tanggung jawabnya dalam melaksanakan audit untuk selalu mengedepankan “Independensi” atau ketidaktergantungan kepada pihak manapun;",
                    "Auditor internal sebagai kapasitasnya dalam jabatan tertentu tidak diperkenankan menggunakan kewenangannya melakukan intervensi dalam pelaksanaan audit yang mengakibatkan terjadinya konflik kepentingan pada ketidaksesuaian yang terjadi;",
                    "Auditor internal tidak diperbolehkan melakukan penghilangan atau penambahan temuan audit ketika kegiatan audit sudah selesai."
                ];
                break;
            default:
                $pernyataan = "Pernyataan tidak ditemukan untuk role yang dipilih.";
                $perjanjian = ["Perjanjian tidak ditemukan untuk role yang dipilih."];
                break;
        }

        return compact('pernyataan', 'perjanjian', 'judul');
    }

    public function viewSurat($role, $id)
    {
        // Temukan data berdasarkan ID
        $data = PaktaIntegritas::findOrFail($id);

        // Dapatkan pernyataan, perjanjian, dan judul berdasarkan role
        $result = $this->getPerjanjianByRole($role);
        $pernyataan = $result['pernyataan'];
        $perjanjian = $result['perjanjian'];
        $judul = $result['judul'];

        // Konversi gambar ke base64
        $path = public_path('assets/kop-surat.jpg');
        $type = pathinfo($path, PATHINFO_EXTENSION);
        $dataGambar = file_get_contents($path);
        $base64 = 'data:image/' . $type . ';base64,' . base64_encode($dataGambar);

        $qrcodeSvg = QrCode::format('svg')->size(80)->generate($data->no_whatsapp);
        $qrcodeSvgClean = str_replace('<?xml version="1.0" encoding="UTF-8"?>', '', $qrcodeSvg);
        $qrcodeBase64 = base64_encode($qrcodeSvgClean);

        // Tampilkan view template surat di browser
        return view('template.template_surat', compact('data', 'pernyataan', 'perjanjian', 'base64', 'judul', 'qrcodeBase64'));
    }

}


reosurces/view/admin/
admin_login.blade.php
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMI BPMSPH</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{{ asset('style/style_admin.css') }}" />
</head>

<body>
    <div class="container-login" style="background-image: url('{{ asset('assets/login-bg.png') }}');">
        <div class="login-content">
            <div class="login-left">
                <img src="{{ asset('assets/logo smi.png') }}" alt="">
                <h3>SISTEM MANAJEMEN INTEGRASI</h3>
                <form action="" method="POST">
                    @csrf
                    <div class="form-group-login">
                        <label for="email">Email or Username</label>
                        <input type="text" id="login" name="login" placeholder="Email or Username" required>
                    </div>
                    <div class="form-group-login">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" placeholder="Password" required>
                    </div>
                    <div class="form-group-login-show" >
                        <input type="checkbox" id="show-password" onclick="togglePasswordVisibility()">
                        <label for="show-password">Lihat Password</label>
                    </div>
                    <button class="btn-login" type="submit">Login</button>
                </form>
            </div>
            <div class="login-right">
                <img src="{{ asset('assets/login-right.png') }}" alt="foto">
            </div>
        </div>
    </div>
    <script src="{{ asset('script/script-admin.js') }}"></script>

</body>
</html>


admin_home
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMI BPMSPH</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{{ asset('style/style_admin.css') }}" />
</head>

<body>
    <nav class="container-navbar-admin">
        <a href="/">
            <div class="logo">
                <img src="../assets/logo smi.png" alt="Logo Image" class="logo-img">
                <h3>SMI BPMSPH</h3>
            </div>
        </a>
        <div class="logout-admin">
            <button class="logout-btn">Logout</button>
            <form id="logout-form" action="" method="POST" style="display: none;">
                @csrf
            </form>
        </div>
    </nav> <!-- navbar end -->

    <div class="container-admin">
        <div class="sidebar-admin">
            <a href="/admin/home">
                <div class="box-admin">
                    <h3>Beranda</h3>
                </div>
            </a>
            <div class="dropdown-admin">
                <div class="select-admin">
                    <h5 class="selected">Pakta Integritas</h5>
                    <div class="caret"></div>
                </div>
                <ul class="menu-admin">
                    <li class="active">Pakta Integritas</li>
                    <a href="/admin/pegawai">
                        <li>Pegawai</li>
                    </a>
                    <a href="/admin/penyedia-jasa">
                        <li>Penyedia Jasa</li>
                    </a>
                    <a href="/admin/pengguna-jasa">
                        <li>Pengguna Jasa</li>
                    </a>
                    <a href="/admin/auditor">
                        <li>Auditor</li>
                    </a>
                </ul>
            </div>
        </div>
        <div class="content-admin">
            <header>
                <h1>Selamat Datang, Admin SMI Pakta Integritas</h1>
            </header>
            <hr class="header-line">
            <div class="cards-admin">
                <div class="card green">
                    <h2>Pakta Integritas Pegawai</h2>
                    <p>Jumlah</p>
                    <a href="{{ route('admin.role', ['role' => 'pegawai']) }}">
                        <h3>{{ $countPegawai }}</h3>
                    </a>
                    <hr>
                    <a href="{{ route('admin.role', ['role' => 'pegawai']) }}">
                        <p>View Details <i class="fa-solid fa-chevron-right"></i></p>
                    </a>
                    <img src="../assets/icon-note-white.svg" alt="Document Icon">
                </div>
                <div class="card blue">
                    <h2>Pakta Integritas Penyedia Jasa</h2>
                    <p>Jumlah</p>
                    <a href="{{ route('admin.role', ['role' => 'penyedia-jasa']) }}">
                        <h3>{{ $countPenyediaJasa }}</h3>
                    </a>
                    <hr>
                    <a href="{{ route('admin.role', ['role' => 'penyedia-jasa']) }}">
                        <p>View Details <i class="fa-solid fa-chevron-right"></i></p>
                    </a>
                    <img src="../assets/icon-note-white.svg" alt="Document Icon">
                </div>
                <div class="card yellow">
                    <h2>Pakta Integritas Pengguna Jasa</h2>
                    <p>Jumlah</p>
                    <a href="{{ route('admin.role', ['role' => 'pengguna-jasa']) }}">
                        <h3>{{ $countPenggunaJasa }}</h3>
                    </a>
                    <hr>
                    <a href="{{ route('admin.role', ['role' => 'pengguna-jasa']) }}">
                        <p>View Details <i class="fa-solid fa-chevron-right"></i></p>
                    </a>
                    <img src="../assets/icon-note-white.svg" alt="Document Icon">
                </div>
                <div class="card red">
                    <h2>Pakta Integritas Auditor</h2>
                    <p>Jumlah</p>
                    <a href="{{ route('admin.role', ['role' => 'auditor']) }}">
                        <h3>{{ $countAuditor }}</h3>
                    </a>
                    <hr>
                    <a href="{{ route('admin.role', ['role' => 'auditor']) }}">
                        <p>View Details <i class="fa-solid fa-chevron-right"></i></p>
                    </a>
                    <img src="../assets/icon-note-white.svg" alt="Document Icon">
                </div>
            </div>
        </div>

        <script src="{{ asset('script/script-admin.js') }}"></script>
</body>

</html>

admin_pegawai ini 4 code sama beda judul rolenya
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMI BPMSPH</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

        <link rel="stylesheet" href="{{ asset('style/style_admin.css') }}" />
</head>

<body>
    <nav class="container-navbar-admin">
        <a href="/">
            <div class="logo">
                <img src="../assets/logo smi.png" alt="Logo Image" class="logo-img">
                <h3>SMI BPMSPH</h3>
            </div>
        </a>
        <div class="logout-admin">
            <button class="logout-btn">Logout</button>
            <form id="logout-form" action="{{ route('admin.logout') }}" method="POST" style="display: none;">
                @csrf
            </form>
        </div>
    </nav> <!-- navbar end -->

    <div class="container-admin">
        <div class="sidebar-admin">
            <a href="/admin/home">
                <div class="box-admin">
                    <h3>Beranda</h3>
                </div>
            </a>

            <div class="dropdown-admin">
                <div class="select-admin">
                    <h5 class="selected">Pakta Integritas</h5>
                    <div class="caret"></div>
                </div>
                <ul class="menu-admin">
                    <li class="active">Pakta Integritas</li>
                    <a href="/admin/pegawai">
                        <li>Pegawai</li>
                    </a>
                    <a href="/admin/penyedia-jasa">
                        <li>Penyedia Jasa</li>
                    </a>
                    <a href="/admin/pengguna-jasa">
                        <li>Pengguna Jasa</li>
                    </a>
                    <a href="/admin/auditor">
                        <li>Auditor</li>
                    </a>
                </ul>
            </div>
        </div>
        <div class="content-admin">

            <header>
                <h1>Tabel Formulir Pakta Integritas Pegawai</h1>
            </header>
            <hr class="header-line">

            <div class="search-section">
                <form action="{{ url()->current() }}" method="GET" autocomplete="off">
                    <input type="text" name="search" placeholder="Search" class="search-box" value="{{ request('search') }}">
                    <button type="submit" class="icon-search"><i class="fa-solid fa-magnifying-glass"></i></button>
                </form>
            </div>

            @if(session('success'))
                <div class="alert alert-success">
                    {{ session('success') }}
                </div>
            @endif

            <div class="down-btn">
                <a href="/admin/add/pegawai"><button class="btn-tambah">Tambah</button></a>
                <a href="{{ route('integritas.export', ['role' => $role]) }}"><button class="btn-export">Export Excel</button></a>
            </div>

            <table class="table-admin">
                <thead>
                    <tr>
                        <th>NO</th>
                        <th>Nama Lengkap</th>
                        <th>Jabatan</th>
                        <th>Instansi</th>
                        <th>Email</th>
                        <th>Nomor WhatsApp</th>
                        <th>Print/ PDF</th>
                        <th>Edit</th>
                        <th>Hapus</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Contoh Baris Tabel -->
                    @foreach ($data as $item)
                    <tr>
                        <td>{{ ($data->currentPage() - 1) * $data->perPage() + $loop->iteration }}</td>
                        <td>{{ $item->nama }}</td>
                        <td>{{ $item->jabatan }}</td>
                        <td>{{ $item->instansi }}</td>
                        <td>{{ $item->email }}</td>
                        <td>{{ $item->no_whatsapp }}</td>
                        <td>
                            <!-- Tombol Download PDF -->
                            <a href="{{ route('integritas.download-pdf', ['role' => $role, 'id' => $item->id]) }}">
                                <div class="icon-action print"><i class="fa fa-print"></i></div>
                            </a>
                        </td>
                        <td>
                            <!-- Tombol Edit -->
                            <a href="{{ route('integritas.edit', ['role' => $role, 'id' => $item->id]) }}">
                                <div class="icon-action pencil"><i class="fa fa-pencil"></i></div>
                            </a>
                        </td>
                        <td>
                            <!-- Tombol Hapus -->
                            <form action="{{ route('integritas.destroy', ['role' => $role, 'id' => $item->id]) }}" method="POST" onsubmit="return confirm('Apakah Anda yakin ingin menghapus data ini?');">
                                @csrf
                                @method('DELETE')
                                <div class="icon-action trash"><button type="submit"><i class="fa fa-trash"></i></button></div>
                            </form>
                        </td>
                    </tr>
                    @endforeach
                    <!-- Tambahkan lebih banyak baris sesuai kebutuhan -->
                </tbody>
            </table>

            <div class="pagination">
                <!-- Previous Page Link -->
                @if ($data->onFirstPage())
                    <span class="disabled">&#x3C;</span>
                @else
                    <a href="{{ $data->previousPageUrl() }}" rel="prev">&#x3C;</a>
                @endif

                <!-- Pagination Elements -->
                @foreach ($data->links()->elements as $element)
                    <!-- "Three Dots" Separator -->
                    @if (is_string($element))
                        <span class="disabled">{{ $element }}</span>
                    @endif

                    <!-- Array Of Links -->
                    @if (is_array($element))
                        @foreach ($element as $page => $url)
                            @if ($page == $data->currentPage())
                                <span class="active">{{ $page }}</span>
                            @else
                                <a href="{{ $url }}">{{ $page }}</a>
                            @endif
                        @endforeach
                    @endif
                @endforeach

                <!-- Next Page Link -->
                @if ($data->hasMorePages())
                    <a href="{{ $data->nextPageUrl() }}" rel="next">&#x3E;</a>
                @else
                    <span class="disabled">&#x3E;</span>
                @endif
            </div>
        </div>
        <script src="{{ asset('script/script-admin.js') }}"></script>
</body>

</html>

admin_edit
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMI BPMSPH</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{{ asset('style/style_admin.css') }}" />
</head>

<body>
    <nav class="container-navbar-admin">
        <a href="/">
            <div class="logo">
                <img src="/assets/logo smi.png" alt="Logo Image" class="logo-img">
                <h3>SMI BPMSPH</h3>
            </div>
        </a>
        <div class="logout-admin">
            <button class="logout-btn">Logout</button>
            <form id="logout-form" action="" method="POST" style="display: none;">
                @csrf
            </form>
        </div>
    </nav> <!-- navbar end -->

    <div class="container-admin">
        <div class="sidebar-admin">
            <a href="/admin/home">
                <div class="box-admin">
                    <h3>Beranda</h3>
                </div>
            </a>

            <div class="dropdown-admin">
                <div class="select-admin">
                    <h5 class="selected">Pakta Integritas</h5>
                    <div class="caret"></div>
                </div>
                <ul class="menu-admin">
                    <li class="active">Pakta Integritas</li>
                    <a href="/admin/pegawai">
                        <li>Pegawai</li>
                    </a>
                    <a href="/admin/penyedia-jasa">
                        <li>Penyedia Jasa</li>
                    </a>
                    <a href="/admin/pengguna-jasa">
                        <li>Pengguna Jasa</li>
                    </a>
                    <a href="/admin/auditor">
                        <li>Auditor</li>
                    </a>
                </ul>
            </div>
        </div>
        <div class="content-admin-edit">
            <header>
                <h1>Edit Data Pakta Integritas {{ $role }}</h1>
            </header>
            <hr class="header-line">
            <div class="isi-form" id="isi-form">
                <!-- Form Container -->
                <div class="form-container-wrapper">
                    <form action="{{ route('integritas.update', ['role' => $role, 'id' => $data->id]) }}" method="POST" id="form-container" class="form-container" autocomplete="off">
                        @csrf
                        @method('PUT') <!-- Tambahkan ini untuk menggunakan metode PUT -->
                        <input type="hidden" name="role" value="{{ $role }}">
                        <h3>FORMULIR PAKTA INTEGRITAS</h3>
                        <div class="img-form"><img src="{{ asset('assets/pembatas.png') }}" alt=""></div>
                        <h3 id="role-title">{{ strtoupper($role) }}</h3>

                        <!-- Form fields dengan data yang diisi -->
                        <div class="form-group">
                            <label for="nama">Nama Lengkap <span>*</span></label>
                            <input type="text" id="nama" name="nama" max-length="100" value="{{ $data->nama }}" required>
                        </div>
                        <div class="form-group">
                            <label for="jabatan">Jabatan <span>*</span></label>
                            <input type="text" id="jabatan" name="jabatan" max-length="50" value="{{ $data->jabatan }}" required>
                        </div>
                        <div class="form-group">
                            <label for="instansi">Instansi <span>*</span></label>
                            <input type="text" id="instansi" name="instansi" max-length="70" value="{{ $data->instansi }}" required>
                        </div>
                        <div class="form-group">
                            <label for="alamat">Alamat Lengkap <span>*</span></label>
                            <textarea id="alamat" name="alamat" max-length="255" required>{{ $data->alamat }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="email">Email <span>*</span></label>
                            <input type="email" id="email" name="email" value="{{ $data->email }}" required>
                        </div>
                        <div class="form-group">
                            <label for="kota">Kota <span>*</span></label>
                            <input type="text" id="kota" name="kota" max-length="35" value="{{ $data->kota }}" required>
                        </div>
                        <div class="form-group">
                            <label for="tanggal">Tanggal <span>*</span></label>
                            <input type="date" id="tanggal" name="tanggal" value="{{ $data->tanggal }}" required>
                        </div>
                        <div class="form-group">
                            <label for="no_whatsapp">Nomor Handphone/WhatsApp <span>*</span>
                                <small>Contoh: 81234567899</small>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">+62</div>
                                <input type="tel" id="no_whatsapp" name="no_whatsapp" value="{{ ltrim(old('no_whatsapp', $data->no_whatsapp), '62') }}" class="form-control" placeholder="81234567899"
                                    pattern="^\d{8,13}$" required>
                            </div>
                        </div>
                        <div class="btn-send-form">
                            <button type="submit">
                                Update <i class="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script src="{{ asset('script/script-admin.js') }}"></script>
</body>

</html>

admin_add
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMI BPMSPH</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{{ asset('style/style_admin.css') }}" />
</head>

<body>
    <nav class="container-navbar-admin">
        <a href="/">
            <div class="logo">
                <img src="/assets/logo smi.png" alt="Logo Image" class="logo-img">
                <h3>SMI BPMSPH</h3>
            </div>
        </a>
        <div class="logout-admin">
            <button class="logout-btn">Logout</button>
            <form id="logout-form" action="" method="POST" style="display: none;">
                @csrf
            </form>
        </div>
    </nav> <!-- navbar end -->

    <div class="container-admin">
        <div class="sidebar-admin">
            <a href="/admin/home">
                <div class="box-admin">
                    <h3>Beranda</h3>
                </div>
            </a>

            <div class="dropdown-admin">
                <div class="select-admin">
                    <h5 class="selected">Pakta Integritas</h5>
                    <div class="caret"></div>
                </div>
                <ul class="menu-admin">
                    <li class="active">Pakta Integritas</li>
                    <a href="/admin/pegawai">
                        <li>Pegawai</li>
                    </a>
                    <a href="/admin/penyedia-jasa">
                        <li>Penyedia Jasa</li>
                    </a>
                    <a href="/admin/pengguna-jasa">
                        <li>Pengguna Jasa</li>
                    </a>
                    <a href="/admin/auditor">
                        <li>Auditor</li>
                    </a>
                </ul>
            </div>
        </div>
        <div class="content-admin-add">
            <header>
                <h1>Silahkan Isi Formulir Berikut</h1>
            </header>
            <hr class="header-line">
            <div class="isi-form" id="isi-form">
                    <!-- Form Container -->
                        <form action="{{ route('integritas.store', ['role' => $role]) }}" method="POST" id="form-container" class="form-container" autocomplete="off">
                            @csrf
                         <input type="hidden" name="role" value="{{ $role }}">
                        <h3>FORMULIR PAKTA INTEGRITAS</h3>
                        <div class="img-form"><img src="{{ asset('assets/pembatas.png') }}" alt=""></div>
                        <h3 id="role-title">{{ strtoupper($role) }}</h3>

                        @csrf

                        <div class="form-group">
                            <label for="nama">Nama Lengkap <span>*</span></label>
                            <input type="text" id="nama" name="nama" max-length="100" required>
                        </div>
                        <div class="form-group">
                            <label for="jabatan">Jabatan <span>*</span></label>
                            <input type="text" id="jabatan" name="jabatan" max-length="70" required>
                        </div>
                        <div class="form-group">
                            <label for="instansi">Instansi <span>*</span></label>
                            <input type="text" id="instansi" name="instansi" max-length="70" required>
                        </div>
                        <div class="form-group">
                            <label for="alamat">Alamat Lengkap <span>*</span></label>
                            <textarea id="alamat" name="alamat" max-length="255" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="email">Email <span>*</span></label>
                            <input type="email" id="email" name="email" placeholder="example@gmail.com" required>
                        </div>
                        <div class="form-group">
                            <label for="kota">Kota <span>*</span></label>
                            <input type="text" id="kota" name="kota" max-length="35" required>
                        </div>
                        <div class="form-group">
                            <label for="tanggal">Tanggal <span>*</span></label>
                            <input type="date" id="tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="no_whatsapp">Nomor Handphone/WhatsApp <span>*</span>
                                <small>Contoh: 81234567899</small>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">+62</div>
                                <input type="tel" id="no_whatsapp" name="no_whatsapp" class="form-control" placeholder="81234567899"
                                    pattern="^\d{8,13}$" required>
                            </div>
                        </div>
                        <div class="btn-send-form">
                            <button type="submit">
                                Kirim <i class="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
            </div>
         </div>


        </div>

        <script src="{{ asset('script/script-admin.js') }}"></script>
</body>

</html>

web.php
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\PaktaIntegritasController;
use App\Http\Controllers\AdminAuthController;

Route::get('/', function () {
    return view('index');
});

Route::get('/lapor', function () {
    return view('lapor');
});
Route::get('/web', function () {
    return view('web');
});

Route::get('/admin', function () {
    return view('admin.admin_login');
})->name('admin.login');

Route::get('/down_surat', function () {
    return view('down_surat');
});
Route::get('/edit_surat', function () {
    return view('edit_surat');
});

route::get('/user/edit-surat/{id}', [PaktaIntegritasController::class, 'editUserSurat'])->name('user.edit-surat');
Route::put('/user/update-surat/{id}', [PaktaIntegritasController::class, 'updateUserSurat'])->name('user.update-surat');

// Rute untuk menyimpan data dari pengguna (dari halaman index)
Route::post('/integritas/store', [PaktaIntegritasController::class, 'store'])->name('integritas.store');

// Rute untuk menampilkan halaman down_surat setelah pengguna menyimpan data
Route::get('/user/down-surat', [PaktaIntegritasController::class, 'userSurat'])->name('user.down-surat');

// Rute untuk admin
Route::get('/admin/{role}', [PaktaIntegritasController::class, 'index'])->name('admin.role');
Route::post('/admin/add/{role}', [PaktaIntegritasController::class, 'store'])->name('integritas.store.admin');
Route::get('/admin/add/{role}', [PaktaIntegritasController::class, 'showForm'])->name('admin.add');
Route::delete('/admin/{role}/{id}', [PaktaIntegritasController::class, 'destroy'])->name('integritas.destroy');
Route::get('/admin/{role}/edit/{id}', [PaktaIntegritasController::class, 'edit'])->name('integritas.edit');
Route::put('/admin/{role}/{id}', [PaktaIntegritasController::class, 'update'])->name('integritas.update');


Route::get('/admin/{role}/export', [PaktaIntegritasController::class, 'export'])->name('integritas.export');
Route::get('/admin/{role}/download-pdf/{id}', [PaktaIntegritasController::class, 'downloadPdf'])->name('integritas.download-pdf');
Route::get('/admin/{role}/view-surat/{id}', [PaktaIntegritasController::class, 'viewSurat'])->name('integritas.view-surat');
Route::post('/admin/logout', function () {
    Auth::logout();
    return redirect('/admin');
})->name('admin.logout');
